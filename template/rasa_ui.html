<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cinemora</title>
    {% load static %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="icon" href="{% static 'favicon_io/rasa_favicon.png' %}">
    <link rel="stylesheet" href="{% static 'css/rasa_ui.css' %}">
</head>
<body>
<div class="chat-container">
    <img src="{% static 'project_data/Cinemora.png' %}" alt="">
    <!-- <h1>Welcome to Cinemora</h1> -->
    <div id="chat"></div>
    <form class="input-container" onsubmit="sendMessage(); return false;">
        <input id="msg" type="text" placeholder="Type a message...">
        <button type="submit" class="btn-btn-img">Send</button>
    </form>
</div>
  
  <script>
    const chatBox = document.getElementById("chat");

    async function sendMessage() {
      const msgInput = document.getElementById("msg");
      const message = msgInput.value.trim();
      if (!message) return;

      // Show user message
      chatBox.innerHTML += `<div class="user">You: ${message}</div>`;
      chatBox.scrollTop = chatBox.scrollHeight;

      // Send to Rasa REST webhook
      const res = await fetch("http://localhost:5005/webhooks/rest/webhook", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sender: "user1", message: message })
      });
      const data = await res.json();
      console.log(data)
      data.forEach(r => {
        if (r.text) {
          chatBox.innerHTML += `<div class="bot">Bot: ${r.text}<br></div>`;
        }
        if (r.image) {
        chatBox.innerHTML += `<div><img src="${r.image}" alt="image" style="width:80%; height:75%;"/></div>`;
        }
      });

      msgInput.value = "";
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
